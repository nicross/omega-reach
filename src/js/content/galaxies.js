content.galaxies = (() => {
  const generated = new Map(),
    names = new Set()

  const greekLetters = [
    'Alpha', 'Beta', 'Gamma', 'Delta', 'Epsilon',
    'Zeta', 'Eta', 'Theta', 'Iota', 'Kappa',
    'Lambda', 'Mu', 'Nu', 'Xi', 'Omicron',
    'Pi', 'Rho', 'Sigma', 'Tau', 'Upsilon',
    'Phi', 'Chi', 'Psi',
  ]

  const latinLetters = [
    'A', 'B', 'C', 'D', 'E',
    'F', 'G', 'H', 'I', 'J',
    'K', 'L', 'M', 'N', 'O',
    'P', 'Q', 'R', 'S', 'T',
    'U', 'V', 'W', 'X', 'Y',
    'Z',
  ]

  function generate(name) {
    const srand = (seed) => engine.fn.srand('galaxy', name, 'attribute', seed)()

    return {
      age: srand('age'),
      mass: srand('mass'),
      name,
      type: engine.fn.chooseWeighted([
        {label: 'Elliptical', weight: 1/3},
        {label: 'Lenticular', weight: 1/3/3},
        {label: 'Irregular', weight: 1/3/3},
        {label: 'Peculiar', weight: 1/3/3},
        {label: 'Spiral', weight: 1/3},
      ], srand('type')).label,
      wildcard: srand('wildcard'),
    }
  }

  function randomGreek() {
    return engine.fn.choose(greekLetters, Math.random())
  }

  function randomInteger(max) {
    return engine.fn.randomInt(1, max)
  }

  function randomLatin() {
    return engine.fn.choose(latinLetters, Math.random())
  }

  function uniqueName() {
    let name

    do {
      name = engine.fn.choose([
        () => `${randomLatin()} ${randomGreek()}`,
        () => `${randomLatin()}${randomInteger(99)} ${randomGreek()}`,
        () => `${randomInteger(99)}${randomLatin()} ${randomGreek()}`,
        () => `${randomInteger(999)} ${randomGreek()}`,
      ], Math.random())()
    } while (names.has(name))

    return name
  }

  return {
    count: () => names.size,
    export: () => ({
      discovered: [...names],
    }),
    get: function (name) {
      if (!generated.has(name)) {
        generated.set(name, generate(name))
      }

      return generated.get(name)
    },
    import: function ({
      discovered = [],
    } = {}) {
      for (const name of discovered) {
        names.add(name)
      }

      return this
    },
    new: function () {
      const name = uniqueName()
      names.add(name)
      return this.get(name)
    },
    names: () => [...names],
    reset: function () {
      generated.clear()
      names.clear()

      return this
    },
  }
})()

engine.state.on('import', ({galaxies}) => content.galaxies.import(galaxies))
engine.state.on('export', (data) => data.galaxies = content.galaxies.export())
engine.state.on('reset', () => content.galaxies.reset())
